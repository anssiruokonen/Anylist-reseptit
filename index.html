<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnyList Recipe Converter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>AnyList Recipe Converter</h1>
        <p class="subtitle">Convert recipes to AnyList-compatible format with schema.org/Recipe JSON-LD markup</p>

        <form id="recipeForm">
            <div class="form-group">
                <label for="recipeName">Recipe Name *</label>
                <input type="text" id="recipeName" required placeholder="e.g., Lyonin Kana">
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" placeholder="A brief description of the recipe"></textarea>
            </div>

            <div class="small-inputs">
                <div class="form-group">
                    <label for="prepTime">Prep Time (min)</label>
                    <input type="number" id="prepTime" placeholder="20">
                </div>

                <div class="form-group">
                    <label for="cookTime">Cook Time (min)</label>
                    <input type="number" id="cookTime" placeholder="45">
                </div>

                <div class="form-group">
                    <label for="servings">Servings</label>
                    <input type="number" id="servings" placeholder="4">
                </div>
            </div>

            <div class="form-group">
                <label for="ingredients">Ingredients * (one per line)</label>
                <textarea id="ingredients" required placeholder="600g chicken thighs, boneless&#10;200g button mushrooms, sliced&#10;2 large onions, thinly sliced" rows="10"></textarea>
            </div>

            <div class="form-group">
                <label for="instructions">Instructions * (one step per line)</label>
                <textarea id="instructions" required placeholder="Season chicken with salt, pepper, and paprika&#10;Heat oil in skillet, sear chicken 4-5 min per side until golden" rows="10"></textarea>
            </div>

            <button type="submit">Generate Recipe HTML</button>
        </form>

        <div class="output-section" id="outputSection" style="display: none;">
            <h2>Generated HTML</h2>
            <p class="subtitle">Copy this HTML or download it, then open in a browser and import to AnyList</p>
            <textarea id="output" readonly></textarea>
            <button type="button" class="download-btn" id="downloadBtn">Download HTML</button>
        </div>
    </div>

    <script>
        const form = document.getElementById('recipeForm');
        const outputSection = document.getElementById('outputSection');
        const output = document.getElementById('output');
        const downloadBtn = document.getElementById('downloadBtn');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            generateRecipeHTML();
        });

        downloadBtn.addEventListener('click', function() {
            downloadHTML();
        });

        function generateRecipeHTML() {
            const recipeName = document.getElementById('recipeName').value.trim();
            const description = document.getElementById('description').value.trim();
            const prepTime = document.getElementById('prepTime').value;
            const cookTime = document.getElementById('cookTime').value;
            const servings = document.getElementById('servings').value;
            const ingredientsText = document.getElementById('ingredients').value.trim();
            const instructionsText = document.getElementById('instructions').value.trim();

            // Parse ingredients and instructions
            const ingredients = ingredientsText.split('\n').filter(line => line.trim());
            const instructions = instructionsText.split('\n').filter(line => line.trim());

            // Build JSON-LD
            const recipeData = {
                "@context": "https://schema.org",
                "@type": "Recipe",
                "name": recipeName
            };

            if (description) {
                recipeData.description = description;
            }

            if (prepTime) {
                recipeData.prepTime = `PT${prepTime}M`;
            }

            if (cookTime) {
                recipeData.cookTime = `PT${cookTime}M`;
            }

            if (servings) {
                recipeData.recipeYield = servings;
            }

            recipeData.recipeIngredient = ingredients;

            recipeData.recipeInstructions = instructions.map((step, index) => ({
                "@type": "HowToStep",
                "position": index + 1,
                "text": step
            }));

            // Generate HTML
            const html = generateHTML(recipeName, description, prepTime, cookTime, servings, ingredients, instructions, recipeData);

            output.value = html;
            outputSection.style.display = 'block';
            outputSection.scrollIntoView({ behavior: 'smooth' });
        }

        function generateHTML(name, description, prepTime, cookTime, servings, ingredients, instructions, jsonLD) {
            let metaHTML = '';
            const metaParts = [];

            if (prepTime) metaParts.push(`<div><strong>Prep:</strong> ${prepTime} min</div>`);
            if (cookTime) metaParts.push(`<div><strong>Cook:</strong> ${cookTime} min</div>`);
            if (servings) metaParts.push(`<div><strong>Servings:</strong> ${servings}</div>`);

            if (metaParts.length > 0) {
                metaHTML = `\n        <div class="recipe-meta">\n            ${metaParts.join('\n            ')}\n        </div>`;
            }

            const descHTML = description ? `\n        <p class="description">${escapeHTML(description)}</p>` : '';

            const ingredientsHTML = ingredients.map(ing => `            <li>${escapeHTML(ing)}</li>`).join('\n');
            const instructionsHTML = instructions.map(inst => `            <li>${escapeHTML(inst)}</li>`).join('\n');

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${escapeHTML(name)}</title>
    <link rel="stylesheet" href="../style.css">
    <script type="application/ld+json">
${JSON.stringify(jsonLD, null, 2)}
    </script>
</head>
<body>
    <div class="container">
        <h1>${escapeHTML(name)}</h1>${descHTML}${metaHTML}

        <div class="recipe-content">
            <div class="ingredients">
                <h2>Ingredients</h2>
                <ul>
${ingredientsHTML}
                </ul>
            </div>

            <div class="instructions">
                <h2>Instructions</h2>
                <ol>
${instructionsHTML}
                </ol>
            </div>
        </div>
    </div>
</body>
</html>`;
        }

        function escapeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function downloadHTML() {
            const recipeName = document.getElementById('recipeName').value.trim();
            const filename = recipeName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '') + '.html';

            const blob = new Blob([output.value], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
